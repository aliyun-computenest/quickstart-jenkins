<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="计算巢是阿里云开放给企业应用服务商的服务管理平台。服务商能够在计算巢上发布私有化部署服务，为其客户提供云上软件一键部署的能力；同时也支持全托管模式的服务，赋能服务商托管其客户资源。">
  <title>在ACK集群中部署Jenkins - Aliyun 计算巢 x Demo</title>

  <link rel="shortcut icon" href="../img/favicon.ico">

  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css">
  <link rel="stylesheet" href="../css/theme.css">
  

  

  
  

  
    <script src="../search/main.js"></script>
  

  

  <script src="../js/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>

<body>
  <div class="container">
    <div class="nav">
      <div class="nav-inner">
        <div class="logo">
          <img src="./img/logo-2x.png">
        </div>
        <div class="nav-list">
          <ul>
          
              <li><a href="#ackjenkins">在ACK集群中部署Jenkins</a></li>
              
                  <li><a href="#_1">概述</a></li>
                  
              
                  <li><a href="#ram">RAM账号所需权限</a></li>
                  
              
                  <li><a href="#jenkins">部署Jenkins服务</a></li>
                  
                      <li class="li-h3"><a href="#_2">参数说明</a></li>
                  
              
                  <li><a href="#jenkins_1">执行Jenkins构建任务</a></li>
                  
              
                  <li><a href="#ecijenkins">使用抢占式ECI实例执行Jenkins构建任务</a></li>
                  
              
          
          </ul>
        </div>
      </div>
    </div>
    <div class="content theme-github">
      
      <div class="content-inner">        
        
        <h1 id="ackjenkins">在ACK集群中部署Jenkins</h1>
<h2 id="_1">概述</h2>
<p>Jenkins是一个开源软件项目，是基于Java开发的一种持续集成工具，用于监控持续重复的工作，旨在提供一个开放易用的软件平台，使软件项目可以进行持续集成。Jenkins在计算巢上提供了社区版服务，您无需自行配置云主机，即可在计算巢上快速部署Jenkins服务、实现运维监控，从而方便地基于Jenkins搭建您自己的应用。本文向您介绍如何开通计算巢上的Jenkins社区版服务，以及部署流程和使用说明。</p>
<h2 id="ram">RAM账号所需权限</h2>
<p>Jenkins服务需要对ECS、VPC等资源进行访问和创建操作，若您使用RAM用户创建服务实例，需要在创建服务实例前，对使用的RAM用户的账号添加相应资源的权限。添加RAM权限的详细操作，请参见<a href="https://help.aliyun.com/document_detail/121945.html">为RAM用户授权</a>
。所需权限如下表所示。</p>
<table>
<thead>
<tr>
<th>权限策略名称</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>AliyunECSFullAccess</td>
<td>管理云服务器服务（ECS）的权限</td>
</tr>
<tr>
<td>AliyunVPCFullAccess</td>
<td>管理专有网络（VPC）的权限</td>
</tr>
<tr>
<td>AliyunROSFullAccess</td>
<td>管理资源编排服务（ROS）的权限</td>
</tr>
<tr>
<td>AliyunComputeNestUserFullAccess</td>
<td>管理计算巢服务（ComputeNest）的用户侧权限</td>
</tr>
<tr>
<td>AliyunCloudMonitorFullAccess</td>
<td>管理云监控（CloudMonitor）的权限</td>
</tr>
<tr>
<td>AliyunCSFullAccess</td>
<td>管理云监控（CloudMonitor）的权限</td>
</tr>
</tbody>
</table>
<h2 id="jenkins">部署Jenkins服务</h2>
<p>单击<a href="https://computenest.console.aliyun.com/user/cn-hangzhou/serviceInstanceCreate?ServiceId=service-5789653a5cbe4817a4a7">部署链接</a>
，进入服务实例部署界面，选择<strong>容器集群版</strong>，根据界面提示填写参数完成部署。</p>
<h3 id="_2">参数说明</h3>
<p>您在创建服务实例的过程中，需要配置服务实例信息。下文介绍Jenkins社区版服务实例输入参数的详细信息。</p>
<table>
<thead>
<tr>
<th>参数组</th>
<th>示例</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>服务实例名称</td>
<td>jenkins-3pgt</td>
<td>实例的名称</td>
</tr>
<tr>
<td>地域</td>
<td>华东1（杭州）</td>
<td>选中服务实例的地域，建议就近选中，以获取更好的网络延时。</td>
</tr>
<tr>
<td>k8s集群Id</td>
<td>c377ad508<strong><em>*</em></strong>****</td>
<td>部署应用程序的K8s集群ID</td>
</tr>
<tr>
<td>软件配置信息</td>
<td><code>{"controller": { "serviceType": "LoadBalancer","admin": {"password": "Password"}},"persistence": {"size": "40Gi","storageClass": "alicloud-disk-essd"}}</code></td>
<td>Jenkins软件的配置信息(账号为admin, 请修改密码)</td>
</tr>
</tbody>
</table>
<p><img alt="1.jpg" src="../ack1.jpg" /></p>
<h2 id="jenkins_1">执行Jenkins构建任务</h2>
<ol>
<li>服务实例创建成功后，进入服务实例概览页，可以通过Endpoint和AdminPassword登录 Jenkins。</li>
</ol>
<p><img alt="3.jpg" src="../ack2.jpg" /></p>
<ol>
<li>在左侧导航栏单击New Item。 在Enter an item name区域，输入名称（Demo），选择Pipeline类型，然后单击OK。</li>
</ol>
<p><img alt="3.jpg" src="../ack3.jpg" /></p>
<ol>
<li>在页面顶部单击Pipeline页签，选择Hello World模板，配置pipeline，然后单击Save。</li>
</ol>
<p><img alt="3.jpg" src="../ack4.jpg" /></p>
<ol>
<li>在页面左侧导航栏中，单击Build Now执行构建。在构建流水线时，Jenkins会默认从当前ACK集群中动态启动一个Slave Pod并执行构建任务，构建任务执行完毕后会立即释放该Slave Pod。</li>
</ol>
<p><img alt="3.jpg" src="../ack5.jpg" /></p>
<ol>
<li>通过计算巢服务实例资源栏，登录到容器服务控制台。</li>
</ol>
<p><img alt="3.jpg" src="../ack6.jpg" /></p>
<ol>
<li>容器组中可查看由Jenkins构建任务创建的Slave Pod。</li>
</ol>
<p><img alt="3.jpg" src="../ack8.jpg" /></p>
<ol>
<li>在Jenkins页面左侧导航栏中，单击Build History，单击目标流水线进入详情页面，然后单击Console Output即可查看流水线构建结果。</li>
</ol>
<p><img alt="3.jpg" src="../ack9.jpg" /></p>
<h2 id="ecijenkins">使用抢占式ECI实例执行Jenkins构建任务</h2>
<p>注意事项：
使用该功能时，请确保集群中的VK（ack-virtual-node组件）为最新版本。关于如何升级组件，请参见<a href="https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/manage-system-components">管理组件</a>。</p>
<ol>
<li>参考<a href="https://help.aliyun.com/zh/ack/ack-managed-and-ack-dedicated/user-guide/configure-an-eci-profile?spm=a2c4g.11186623.0.0.67735296sWTFHJ#section-qik-e6p-s4x">配置说明</a>(使用编辑操作)修改eci-profile中的selectors属性为：</li>
</ol>
<p><code>json
   [{
       "name": "selector-eci",
       "namespaceSelector": {
           "matchLabels": {
               "type": "eci"
           }
       },
       "effect": {
           "annotations": {
               "k8s.aliyun.com/eci-spot-strategy": "SpotAsPriceGo"
           }
       }
   }]</code></p>
<p><img alt="3.jpg" src="../eci1.jpg" /></p>
<ol>
<li>编辑Jenkins的命名空间并添加标签：</li>
</ol>
<p><code>type：eci</code></p>
<p><img alt="3.jpg" src="../eci2.jpg" /></p>
<ol>
<li>运行Jenkins构建任务，Jenkins会默认从当前ACK集群中动态启动一个抢占式ECI Pod并执行构建任务。</li>
</ol>
<p><img alt="3.jpg" src="../eci3.jpg" /></p>
<ol>
<li>在ECI控制台可以看到对应的ECI实例，构建任务执行完毕后会立即释放该ECI实例。</li>
</ol>
<p><img alt="3.jpg" src="../eci4.jpg" /></p>
        
      </div>

      <div class="copyrights">© 2009-2022 Aliyun.com 版权所有</div>
    </div>
  </div>
  
  <!--
  MkDocs version      : 1.6.1
  Docs Build Date UTC : 2024-09-05 09:19:25.844771+00:00
  -->
</body>
</html>